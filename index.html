<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGINX Ingress Migration Guide</title>
    <style>
        :root {
            --primary-color: #009639;
            --primary-dark: #006b2b;
            --secondary-color: #0066b3;
            --plus-color: #f57c00;
            --oss-color: #009639;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #e0e0e0;
            --code-bg: #f4f4f4;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: var(--text-color); background-color: var(--bg-color); }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        header { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; padding: 40px 0; margin-bottom: 30px; }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        header p { font-size: 1.1rem; opacity: 0.9; }
        nav { background: var(--card-bg); padding: 15px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        nav ul { list-style: none; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        nav a { color: var(--primary-color); text-decoration: none; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; transition: all 0.3s; }
        nav a:hover { background: var(--primary-color); color: white; }
        main { padding: 20px 0 60px; }
        section { background: var(--card-bg); border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h2 { color: var(--primary-color); border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 25px; font-size: 1.8rem; }
        h3 { color: var(--secondary-color); margin: 30px 0 15px; font-size: 1.3rem; }
        .table-wrapper { overflow-x: auto; margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .mapping-table th, .mapping-table td { width: 50%; white-space: nowrap; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
        th { background: var(--primary-color); color: white; font-weight: 600; }
        tr.expandable { cursor: pointer; transition: background-color 0.2s; }
        tr.expandable:hover { background-color: #e8f5e9; }
        tr.expandable td:first-child { display: flex; align-items: baseline; }
        tr.expandable td:first-child::before { content: '▶'; flex-shrink: 0; margin-right: 8px; font-size: 0.7rem; transition: transform 0.2s; color: var(--primary-color); }
        tr.expandable.expanded td:first-child::before { transform: rotate(90deg); }
        tr.example-row { display: none; }
        tr.example-row.visible { display: table-row; }
        tr.example-row td { padding: 0; background: #fafafa; }
        .example-content { padding: 20px; border-left: 4px solid var(--primary-color); margin: 10px; background: white; border-radius: 0 8px 8px 0; }
        tr:not(.expandable):not(.example-row):hover { background-color: #f5f5f5; }
        .annotation-list { display: flex; flex-direction: column; gap: 4px; }
        code { background: var(--code-bg); padding: 2px 6px; border-radius: 4px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; color: #d63384; }
        pre { background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem; line-height: 1.5; margin: 15px 0; }
        pre code { background: none; color: inherit; padding: 0; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .comparison { grid-template-columns: 1fr; } }
        .comparison-block { border-radius: 8px; overflow: hidden; }
        .comparison-block h5 { padding: 10px 15px; margin: 0; font-size: 0.9rem; }
        .comparison-block.old h5 { background: #ffebee; color: #c62828; }
        .comparison-block.new h5 { background: #e8f5e9; color: #2e7d32; }
        .comparison-block pre { margin: 0; border-radius: 0 0 8px 8px; }
        .badge { font-size: 0.7rem; padding: 3px 8px; border-radius: 10px; font-weight: 500; margin-left: 5px; white-space: nowrap; }
        .badge-virtualserver { background: #e3f2fd; color: #1565c0; }
        .badge-virtualserverroute { background: #e8eaf6; color: #283593; }
        .badge-policy { background: #f3e5f5; color: #7b1fa2; }
        .badge-transportserver { background: #fff3e0; color: #ef6c00; }
        .badge-globalconfiguration { background: #efebe9; color: #4e342e; }
        .badge-plus { background: #fff3e0; color: #e65100; }
        .badge-annotation { background: #e0f2f1; color: #00695c; }
        .badge-configmap { background: #fff9c4; color: #f57f17; }
        .badge-oss { background: #e8f5e9; color: #2e7d32; }
        .install-box { background: linear-gradient(135deg, #1a237e, #283593); color: white; padding: 15px 20px; border-radius: 8px; margin: 20px 0 15px; }
        .install-box h6 { margin: 0 0 10px; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
        .install-box h6::before { content: '⚙️'; }
        .install-box pre { background: rgba(0,0,0,0.3); margin: 0; padding: 12px 15px; font-size: 0.8rem; border-radius: 8px; }
        .install-box code { color: #90caf9; background: none; }
        .info-box { padding: 12px 16px; border-radius: 6px; margin: 15px 0; font-size: 0.9rem; }
        .info-box.note { background: #e3f2fd; border-left: 4px solid #2196f3; }
        .info-box.tip { background: #e8f5e9; border-left: 4px solid #4caf50; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: #e0e0e0; color: var(--text-color); }
        .btn-secondary:hover { background: #d0d0d0; }
        .edition-header { display: flex; align-items: center; gap: 15px; margin: 40px 0 20px; padding: 15px 20px; border-radius: 8px; }
        .edition-header.oss { background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-left: 5px solid var(--oss-color); }
        .edition-header.plus { background: linear-gradient(135deg, #fff3e0, #ffe0b2); border-left: 5px solid var(--plus-color); }
        .edition-header h3 { margin: 0; font-size: 1.4rem; }
        .edition-header.oss h3 { color: var(--oss-color); }
        .edition-header.plus h3 { color: var(--plus-color); }
        .edition-header p { margin: 5px 0 0; font-size: 0.9rem; color: #666; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; margin: 20px 0; }
        .feature-card { background: #f8f9fa; border-radius: 12px; padding: 25px; border: 1px solid var(--border-color); }
        .feature-card h4 { color: var(--primary-color); margin: 0 0 15px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .feature-card .description { font-size: 0.95rem; color: #555; margin-bottom: 15px; line-height: 1.5; }
        .feature-card ul { margin: 0; padding-left: 20px; }
        .feature-card li { margin: 8px 0; font-size: 0.9rem; }
        .feature-card li strong { color: var(--secondary-color); }
        .legend { display: flex; flex-wrap: wrap; gap: 15px; margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.85rem; }
        .crd-indicator { color: var(--primary-color); font-weight: 500; }
        .checklist { list-style: none; padding: 0; }
        .checklist li { padding: 10px 0 10px 35px; position: relative; border-bottom: 1px solid var(--border-color); }
        .checklist li::before { content: '☐'; position: absolute; left: 0; font-size: 1.2rem; color: var(--primary-color); }
        footer { background: var(--text-color); color: white; padding: 30px 0; text-align: center; }
        footer a { color: #90EE90; }
        .copy-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; float: right; }
        .copy-btn:hover { background: rgba(255,255,255,0.3); }
        .copy-btn.copied { background: #4caf50; }
        .approach-tabs { display: flex; gap: 0; margin-bottom: 15px; border-bottom: 2px solid var(--border-color); }
        .approach-tab { padding: 8px 20px; border: none; background: none; cursor: pointer; font-size: 0.9rem; font-weight: 500; color: #666; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; }
        .approach-tab:hover { color: var(--primary-color); }
        .approach-tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .approach-content { display: none; }
        .approach-content.active { display: block; }
        h2[id], h3[id] { display: flex; align-items: center; }
        .heading-anchor { display: inline-flex; align-items: center; margin-left: 8px; opacity: 0; transition: opacity 0.2s; text-decoration: none; color: inherit; }
        h2:hover .heading-anchor, h3:hover .heading-anchor, .heading-anchor:focus { opacity: 0.5; }
        .heading-anchor:hover { opacity: 1 !important; }
        #yamlInput { width: 100%; min-height: 300px; background: #1e1e1e; color: #d4d4d4; border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85rem; line-height: 1.5; resize: vertical; tab-size: 2; }
        #yamlInput::placeholder { color: #666; }
        #yamlInput:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0,150,57,0.15); }
        .analyzer-actions { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .analyzer-summary { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .analyzer-pill { padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
        .analyzer-pill.found { background: #e8f5e9; color: #2e7d32; }
        .analyzer-pill.paths { background: #e3f2fd; color: #1565c0; }
        .analyzer-pill.crds { background: #fff3e0; color: #ef6c00; }
        .analyzer-pill.unrecognized { background: #ffebee; color: #c62828; }
        .analyzer-card { background: var(--card-bg); border-radius: 8px; padding: 16px 20px; margin-bottom: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); border-left: 4px solid var(--primary-color); }
        .analyzer-card.type-annotation { border-left-color: #00897b; }
        .analyzer-card.type-configmap { border-left-color: #f9a825; }
        .analyzer-card.type-virtualserver { border-left-color: #1565c0; }
        .analyzer-card.type-virtualserverroute { border-left-color: #283593; }
        .analyzer-card.type-policy { border-left-color: #7b1fa2; }
        .analyzer-card.type-transportserver { border-left-color: #ef6c00; }
        .analyzer-card.type-globalconfiguration { border-left-color: #4e342e; }
        .analyzer-card.unrecognized { border-left-color: #c62828; }
        .analyzer-card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; flex-wrap: wrap; }
        .analyzer-card-header .found-annotations { flex: 1; }
        .analyzer-card-header .found-annotations code { display: inline-block; margin: 2px 4px 2px 0; }
        .analyzer-card-body { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-color); font-size: 0.9rem; }
        .analyzer-card-body .migration-arrow { color: var(--primary-color); font-weight: 600; margin-right: 6px; }
        .analyzer-card-footer { margin-top: 10px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px; }
        .analyzer-card-footer .category-label { font-size: 0.8rem; color: #888; }
        .analyzer-card-footer a { font-size: 0.85rem; color: var(--primary-color); text-decoration: none; font-weight: 500; }
        .analyzer-card-footer a:hover { text-decoration: underline; }
        .analyzer-card .annotation-value { color: #888; font-size: 0.82rem; margin-left: 4px; }
        .analyzer-error { padding: 12px 16px; border-radius: 6px; margin-top: 15px; font-size: 0.9rem; background: #ffebee; border-left: 4px solid #c62828; color: #c62828; }
        .analyzer-info { padding: 12px 16px; border-radius: 6px; margin-top: 15px; font-size: 0.9rem; background: #e3f2fd; border-left: 4px solid #2196f3; color: #1565c0; }
        #analyzerResults { margin-top: 20px; }
        .analyzer-unrecognized-section { margin-top: 20px; }
        .analyzer-unrecognized-section h4 { color: #c62828; margin-bottom: 10px; font-size: 1rem; }
        .plus-indicator { font-size: 0.75rem; padding: 2px 6px; background: #fff3e0; color: #e65100; border-radius: 8px; font-weight: 500; margin-left: 6px; }
    </style>
</head>
<body>
    <header>
        <div class="container" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px;">
            <div>
                <h1>NGINX Ingress Migration Guide</h1>
                <p>Migrate from Kubernetes Community NGINX Ingress to Official NGINX Ingress Controller</p>
            </div>
            <a href="https://github.com/alessfg/nginx-ingress-migration-guide" target="_blank" style="display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.15);color:white;text-decoration:none;padding:10px 18px;border-radius:8px;font-size:0.9rem;border:1px solid rgba(255,255,255,0.3);transition:background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.25)'" onmouseout="this.style.background='rgba(255,255,255,0.15)'">
                <svg width="20" height="20" viewBox="0 0 16 16" fill="white"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                Contribute on GitHub
            </a>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="#analyzer">YAML Analyzer</a></li>
                <li><a href="#differences">Key Differences</a></li>
                <li><a href="#oss-mappings">OSS Mappings</a></li>
                <li><a href="#plus-mappings">Plus Mappings</a></li>
                <li><a href="#features">CRD Features</a></li>
                <li><a href="#installation">Installation</a></li>
                <li><a href="#checklist">Checklist</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <!-- YAML Migration Analyzer -->
        <section id="analyzer">
            <h2 id="yaml-analyzer">YAML Migration Analyzer</h2>
            <p>Paste a Kubernetes Ingress YAML manifest that uses community NGINX Ingress annotations to get migration suggestions for the Official NGINX Ingress Controller.</p>
            <textarea id="yamlInput" placeholder="apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    nginx.ingress.kubernetes.io/ssl-redirect: &quot;true&quot;
    nginx.ingress.kubernetes.io/proxy-body-size: &quot;10m&quot;
spec:
  ..."></textarea>
            <div class="analyzer-actions">
                <button class="btn btn-primary" onclick="analyzeYaml()">Analyze YAML</button>
                <button class="btn btn-secondary" onclick="clearAnalyzer()">Clear</button>
                <button class="btn btn-secondary" onclick="loadSampleYaml()">Load Sample</button>
            </div>
            <div id="analyzerResults"></div>
        </section>

        <!-- Key Differences -->
        <section id="differences">
            <h2 id="key-differences">Key Differences</h2>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Aspect</th><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr><td>Repository</td><td><code>kubernetes/ingress-nginx</code></td><td><code>nginx/kubernetes-ingress</code></td></tr>
                        <tr><td>Annotation Prefix</td><td><code>nginx.ingress.kubernetes.io/</code></td><td><code>nginx.org/</code> or <code>nginx.com/</code></td></tr>
                        <tr><td>CRD Support</td><td>Limited</td><td>VirtualServer, VirtualServerRoute, Policy, TransportServer</td></tr>
                        <tr><td>NGINX Plus Support</td><td>No</td><td>Yes (with <code>nginx.com/</code> annotations)</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- OSS Mappings -->
        <section id="oss-mappings">
            <h2 id="oss-mappings">NGINX Open Source Mappings</h2>
            <p>These features are available in both NGINX Open Source and NGINX Plus editions.</p>

            <div class="info-box tip" style="margin: 20px 0;">
                <strong>How to Read the Mappings</strong>
                <ul style="margin: 10px 0 0 20px;">
                    <li><strong>Annotation-to-annotation rows <span style="color: var(--primary-color);">▶</span>:</strong> Direct mappings where you change the annotation name/prefix. Click to expand and see before/after Ingress YAML examples.</li>
                    <li><strong>CRD-based rows <span style="color: var(--primary-color);">▶</span>:</strong> Annotations that map to a CRD (VirtualServer, Policy, or TransportServer). Click to expand for full CRD examples with installation instructions.</li>
                    <li><strong>Grouped annotations:</strong> Related annotations that work together are grouped in a single expandable row, showing how they map to a unified configuration.</li>
                    <li><strong>Official-only rows:</strong> Annotations marked <em>N/A</em> on the left are features unique to the Official controller with no community equivalent.</li>
                </ul>
            </div>

            <div class="controls">
                <input type="text" id="searchInput" placeholder="Search annotations..." onkeyup="filterTable()">
                <button class="btn btn-primary" onclick="expandAllExamples()">Expand All</button>
                <button class="btn btn-secondary" onclick="collapseAllExamples()">Collapse All</button>
            </div>

            <div class="legend">
                <div class="legend-item"><span class="legend-icon">▶</span> Click to expand</div>
                <div class="legend-item"><span class="badge badge-annotation">Annotation</span></div>
                <div class="legend-item"><span class="badge badge-configmap">ConfigMap</span></div>
                <div class="legend-item"><span class="badge badge-virtualserver">VirtualServer CRD</span></div>
                <div class="legend-item"><span class="badge badge-virtualserverroute">VirtualServerRoute CRD</span></div>
                <div class="legend-item"><span class="badge badge-policy">Policy CRD</span></div>
                <div class="legend-item"><span class="badge badge-transportserver">TransportServer CRD</span></div>
            </div>

            <!-- Access Control -->
            <h3 id="access-control">Access Control</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/denylist-source-range</code><code>nginx.ingress.kubernetes.io/whitelist-source-range</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <code>accessControl</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8,172.16.0.0/12"
  nginx.ingress.kubernetes.io/denylist-source-range: "192.168.1.100"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: access-control
spec:
  accessControl:
    allow:
      - 10.0.0.0/8
      - 172.16.0.0/12
    deny:
      - 192.168.1.100</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/satisfy</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code>: <code>satisfy any;</code> or <code>satisfy all;</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/satisfy: "any"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    satisfy any;</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Authentication - Basic -->
            <h3 id="authentication-basic">Authentication (Basic)</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/auth-realm</code><code>nginx.ingress.kubernetes.io/auth-secret</code><code>nginx.ingress.kubernetes.io/auth-secret-type</code><code>nginx.ingress.kubernetes.io/auth-type: "basic"</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/basic-auth-*</code> or <span class="badge badge-policy">Policy CRD</span> <code>basicAuth</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="approach-tabs">
                                <button class="approach-tab active" onclick="switchApproach(this, 'annotation')">Annotation Approach</button>
                                <button class="approach-tab" onclick="switchApproach(this, 'crd')">CRD Approach</button>
                            </div>
                            <div class="approach-content active" data-approach="annotation">
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/auth-type: "basic"
  nginx.ingress.kubernetes.io/auth-secret: "basic-auth"
  nginx.ingress.kubernetes.io/auth-realm: "Protected Area"</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/basic-auth-secret: "basic-auth"
  nginx.org/basic-auth-realm: "Protected Area"</code></pre></div>
                                </div>
                                <div class="info-box note"><strong>Note:</strong> The secret must be of type <code>nginx.org/htpasswd</code>.</div>
                            </div>
                            <div class="approach-content" data-approach="crd">
                                <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                    <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml</code></pre>
                                </div>
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/auth-type: "basic"
  nginx.ingress.kubernetes.io/auth-secret: "basic-auth"
  nginx.ingress.kubernetes.io/auth-realm: "Protected Area"</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: v1
kind: Secret
metadata:
  name: basic-auth
type: nginx.org/htpasswd
data:
  htpasswd: dXNlcjokYXByMS4uLg==
---
apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: basic-auth-policy
spec:
  basicAuth:
    secret: basic-auth
    realm: "Protected Area"</code></pre></div>
                                </div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Buffering -->
            <h3 id="buffering">Buffering</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/client-body-buffer-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/client-body-buffer-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/client-body-buffer-size: "16k"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/client-body-buffer-size: "16k"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-body-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/client-max-body-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-body-size: "10m"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/client-max-body-size: "10m"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-buffer-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-buffer-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-buffer-size: "8k"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-buffer-size: "8k"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-buffering</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-buffering</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-buffering: "on"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-buffering: "on"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-buffers-number</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-buffers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-buffers-number: "4"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-buffers: "4 8k"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official annotation uses a combined format: <code>"number size"</code> (e.g., <code>"4 8k"</code>).</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-busy-buffers-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-busy-buffers-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-busy-buffers-size: "16k"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-busy-buffers-size: "16k"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-max-temp-file-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-max-temp-file-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-max-temp-file-size: "1024m"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-max-temp-file-size: "1024m"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-request-buffering</code></td>
                            <td><span class="badge badge-configmap">ConfigMap</span> <code>proxy-request-buffering</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-request-buffering: "off"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Set via ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  proxy-request-buffering: "off"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Canary / Traffic Splitting -->
            <h3 id="canary-traffic-splitting">Canary / Traffic Splitting</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/canary</code><code>nginx.ingress.kubernetes.io/canary-by-cookie</code><code>nginx.ingress.kubernetes.io/canary-by-header</code><code>nginx.ingress.kubernetes.io/canary-by-header-pattern</code><code>nginx.ingress.kubernetes.io/canary-by-header-value</code><code>nginx.ingress.kubernetes.io/canary-weight</code><code>nginx.ingress.kubernetes.io/canary-weight-total</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>splits[]</code> / <code>matches[]</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># Canary Ingress
annotations:
  nginx.ingress.kubernetes.io/canary: "true"
  nginx.ingress.kubernetes.io/canary-weight: "20"
  nginx.ingress.kubernetes.io/canary-by-header: "X-Canary"
  nginx.ingress.kubernetes.io/canary-by-cookie: "canary"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: main
      service: main-svc
      port: 80
    - name: canary
      service: canary-svc
      port: 80
  routes:
    - path: /
      matches:
        - conditions:
            - header: X-Canary
              value: "true"
          action:
            pass: canary
        - conditions:
            - cookie: canary
              value: "true"
          action:
            pass: canary
      splits:
        - weight: 80
          action: { pass: main }
        - weight: 20
          action: { pass: canary }</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Configuration Snippets -->
            <h3 id="configuration-snippets">Configuration Snippets</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/configuration-snippet</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/configuration-snippet: |
    more_set_headers "X-Custom: value";</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    add_header X-Custom "value";</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/server-snippet</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/server-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/server-snippet: |
    location /health { return 200; }</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/server-snippets: |
    location /health { return 200; }</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/stream-snippet</code></td>
                            <td><span class="badge badge-transportserver">TransportServer CRD</span> or GlobalConfiguration</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/stream-snippet: |
    server { listen 3306; proxy_pass mysql; }</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Use TransportServer CRD instead
apiVersion: k8s.nginx.org/v1
kind: TransportServer
spec:
  listener:
    name: mysql-tcp
    protocol: TCP
  upstreams:
    - name: mysql
      service: mysql
      port: 3306
  action:
    pass: mysql</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- CORS -->
            <h3 id="cors">CORS</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/cors-allow-credentials</code><code>nginx.ingress.kubernetes.io/cors-allow-headers</code><code>nginx.ingress.kubernetes.io/cors-allow-methods</code><code>nginx.ingress.kubernetes.io/cors-allow-origin</code><code>nginx.ingress.kubernetes.io/cors-expose-headers</code><code>nginx.ingress.kubernetes.io/cors-max-age</code><code>nginx.ingress.kubernetes.io/enable-cors</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/server-snippets</code> or <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/enable-cors: "true"
  nginx.ingress.kubernetes.io/cors-allow-origin: "https://frontend.example.com"
  nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
  nginx.ingress.kubernetes.io/cors-allow-headers: "Authorization, Content-Type"
  nginx.ingress.kubernetes.io/cors-allow-credentials: "true"
  nginx.ingress.kubernetes.io/cors-max-age: "86400"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
metadata:
  name: cors-app
spec:
  host: api.example.com
  server-snippets: |
    set $cors_origin "";
    if ($http_origin ~* "^https://frontend\.example\.com$") {
        set $cors_origin $http_origin;
    }
    add_header Access-Control-Allow-Origin $cors_origin always;
    add_header Access-Control-Allow-Credentials "true" always;
    add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
    add_header Access-Control-Allow-Headers "Authorization, Content-Type" always;
    add_header Access-Control-Max-Age 86400 always;
    if ($request_method = OPTIONS) {
        return 204;
    }
  upstreams:
    - name: api-backend
      service: api-service
      port: 80
  routes:
    - path: /
      action:
        pass: api-backend</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official controller does not have dedicated CORS annotations. Use <code>server-snippets</code> or <code>location-snippets</code> to add CORS headers directly in the NGINX configuration.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Error Handling -->
            <h3 id="error-handling">Error Handling</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/custom-http-errors</code><code>nginx.ingress.kubernetes.io/default-backend</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>errorPages[]</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/custom-http-errors: "404,500,502"
  nginx.ingress.kubernetes.io/default-backend: "error-svc"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  routes:
    - path: /
      action:
        pass: backend
      errorPages:
        - codes: [404]
          redirect:
            url: /404.html
            code: 302
        - codes: [500, 502]
          return:
            code: 503
            body: "Service Unavailable"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Headers -->
            <h3 id="headers">Headers</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/connection-proxy-header</code></td>
                            <td>Snippets or <span class="badge badge-configmap">ConfigMap</span></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/connection-proxy-header: "keep-alive"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    proxy_set_header Connection "keep-alive";</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/custom-headers</code></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>responseHeaders.add</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/custom-headers: "default/custom-headers-configmap"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  routes:
    - path: /
      action:
        proxy:
          upstream: my-backend
          responseHeaders:
            add:
              - name: X-Frame-Options
                value: "DENY"
              - name: X-Content-Type-Options
                value: "nosniff"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-hide-headers</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-hide-headers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-hide-headers: "X-Powered-By,Server"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-hide-headers: "X-Powered-By,Server"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-pass-headers</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-pass-headers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-pass-headers: "X-Custom-Header"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-pass-headers: "X-Custom-Header"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/upstream-vhost</code><code>nginx.ingress.kubernetes.io/x-forwarded-prefix</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>requestHeaders.set</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/upstream-vhost: "backend.internal"
  nginx.ingress.kubernetes.io/x-forwarded-prefix: "/api"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  routes:
    - path: /api
      action:
        proxy:
          upstream: my-backend
          requestHeaders:
            set:
              - name: Host
                value: "backend.internal"
              - name: X-Forwarded-Prefix
                value: "/api"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- HSTS -->
            <h3 id="hsts">HSTS</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr><td><em>N/A (ConfigMap only)</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/hsts</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/hsts-max-age</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/hsts-include-subdomains</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/hsts-behind-proxy</code></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="info-box note"><strong>Note:</strong> HSTS annotations are Official NGINX-only. The community controller handles HSTS via ConfigMap only.</div>

            <!-- Load Balancing -->
            <h3 id="load-balancing">Load Balancing</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/load-balance</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/lb-method</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/load-balance: "ewma"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/lb-method: "least_conn"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> Supported methods differ. Official supports: <code>round_robin</code>, <code>least_conn</code>, <code>ip_hash</code>, <code>hash</code>, <code>random</code>.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/service-upstream</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/use-cluster-ip</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/service-upstream: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/use-cluster-ip: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/upstream-hash-by</code><code>nginx.ingress.kubernetes.io/upstream-hash-by-subset</code><code>nginx.ingress.kubernetes.io/upstream-hash-by-subset-size</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>upstreams[].lb-method</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/upstream-hash-by: "$request_uri"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: backend
      service: my-service
      port: 80
      lb-method: "hash $request_uri consistent"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- mTLS (Client) -->
            <h3 id="mtls-client">mTLS (Client Certificate Verification)</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/auth-tls-error-page</code><code>nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream</code><code>nginx.ingress.kubernetes.io/auth-tls-secret</code><code>nginx.ingress.kubernetes.io/auth-tls-verify-client</code><code>nginx.ingress.kubernetes.io/auth-tls-verify-depth</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <code>ingressMTLS</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/auth-tls-secret: "ns/ca-secret"
  nginx.ingress.kubernetes.io/auth-tls-verify-client: "on"
  nginx.ingress.kubernetes.io/auth-tls-verify-depth: "2"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: ingress-mtls
spec:
  ingressMTLS:
    clientCertSecret: ca-secret
    verifyClient: "on"
    verifyDepth: 2</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- mTLS (Backend) -->
            <h3 id="mtls-backend">mTLS (Backend/Egress)</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/proxy-ssl-ciphers</code><code>nginx.ingress.kubernetes.io/proxy-ssl-protocols</code><code>nginx.ingress.kubernetes.io/proxy-ssl-secret</code><code>nginx.ingress.kubernetes.io/proxy-ssl-server-name</code><code>nginx.ingress.kubernetes.io/proxy-ssl-verify</code><code>nginx.ingress.kubernetes.io/proxy-ssl-verify-depth</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <code>egressMTLS</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-ssl-secret: "ns/client-cert"
  nginx.ingress.kubernetes.io/proxy-ssl-verify: "on"
  nginx.ingress.kubernetes.io/proxy-ssl-verify-depth: "2"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: egress-mtls
spec:
  egressMTLS:
    tlsSecret: client-cert
    trustedCertSecret: ca-cert
    verifyServer: true
    verifyDepth: 2</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Miscellaneous -->
            <h3 id="miscellaneous">Miscellaneous</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/enable-access-log</code></td>
                            <td><span class="badge badge-configmap">ConfigMap</span> <code>access-log-off</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/enable-access-log: "false"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Set via ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  access-log-off: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/enable-opentelemetry</code></td>
                            <td><span class="badge badge-configmap">ConfigMap</span> OpenTelemetry settings</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/enable-opentelemetry: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Enable via ConfigMap and CLI args
# See docs.nginx.com for OpenTelemetry setup</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/http2-push-preload</code></td>
                            <td><span class="badge badge-configmap">ConfigMap</span> <code>http2-push-preload</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/http2-push-preload: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Set via ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  http2-push-preload: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/mirror-target</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code> with <code>mirror</code> directive</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/mirror-target: "https://mirror.example.com$request_uri"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    mirror /mirror;
    mirror_request_body on;
  nginx.org/server-snippets: |
    location /mirror {
      internal;
      proxy_pass https://mirror.example.com$request_uri;
    }</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-http-version</code></td>
                            <td><span class="badge badge-configmap">ConfigMap</span> <code>proxy-protocol</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-http-version: "1.1"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Configured via ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  proxy-protocol: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/server-alias</code></td>
                            <td>Create additional VirtualServer resources</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/server-alias: "alias.example.com"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Create a separate VirtualServer per host
apiVersion: k8s.nginx.org/v1
kind: VirtualServer
metadata:
  name: alias-app
spec:
  host: alias.example.com
  routes:
    - path: /
      action:
        pass: main-backend</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/server-tokens</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/server-tokens</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/server-tokens: "false"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/server-tokens: "false"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/websocket-services</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/websocket-services</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/websocket-services: "ws-service"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/websocket-services: "ws-service"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Proxy Settings -->
            <h3 id="proxy-settings">Proxy Settings</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/proxy-next-upstream</code><code>nginx.ingress.kubernetes.io/proxy-next-upstream-timeout</code><code>nginx.ingress.kubernetes.io/proxy-next-upstream-tries</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>upstreams[].next-upstream*</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-next-upstream: "error timeout"
  nginx.ingress.kubernetes.io/proxy-next-upstream-timeout: "30"
  nginx.ingress.kubernetes.io/proxy-next-upstream-tries: "3"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: backend
      service: my-service
      port: 80
      next-upstream: "error timeout"
      next-upstream-timeout: 30s
      next-upstream-tries: 3</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Rate Limiting -->
            <h3 id="rate-limiting">Rate Limiting</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/limit-burst-multiplier</code><code>nginx.ingress.kubernetes.io/limit-connections</code><code>nginx.ingress.kubernetes.io/limit-rate</code><code>nginx.ingress.kubernetes.io/limit-rate-after</code><code>nginx.ingress.kubernetes.io/limit-rpm</code><code>nginx.ingress.kubernetes.io/limit-rps</code><code>nginx.ingress.kubernetes.io/limit-whitelist</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/limit-req-*</code> or <span class="badge badge-policy">Policy CRD</span> <code>rateLimit</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="approach-tabs">
                                <button class="approach-tab active" onclick="switchApproach(this, 'annotation')">Annotation Approach</button>
                                <button class="approach-tab" onclick="switchApproach(this, 'crd')">CRD Approach</button>
                            </div>
                            <div class="approach-content active" data-approach="annotation">
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/limit-rps: "10"
  nginx.ingress.kubernetes.io/limit-burst-multiplier: "5"</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/limit-req-rate: "10r/s"
  nginx.org/limit-req-burst: "50"
  nginx.org/limit-req-delay: "5"</code></pre></div>
                                </div>
                            </div>
                            <div class="approach-content" data-approach="crd">
                                <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                    <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml</code></pre>
                                </div>
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/limit-rps: "10"
  nginx.ingress.kubernetes.io/limit-burst-multiplier: "5"</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: rate-limit
spec:
  rateLimit:
    rate: 10r/s
    burst: 50
    key: ${binary_remote_addr}
    zoneSize: 10M
    rejectCode: 429</code></pre></div>
                                </div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Redirects -->
            <h3 id="redirects">Redirects</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/from-to-www-redirect</code><code>nginx.ingress.kubernetes.io/permanent-redirect</code><code>nginx.ingress.kubernetes.io/permanent-redirect-code</code><code>nginx.ingress.kubernetes.io/temporal-redirect</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>action.redirect</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/permanent-redirect: "https://new.example.com"
  nginx.ingress.kubernetes.io/permanent-redirect-code: "308"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  host: old.example.com
  routes:
    - path: /
      action:
        redirect:
          url: https://new.example.com${request_uri}
          code: 308</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Rewrites -->
            <h3 id="rewrites">Rewrites</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/app-root</code><code>nginx.ingress.kubernetes.io/rewrite-target</code><code>nginx.ingress.kubernetes.io/use-regex</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/rewrites</code> or <span class="badge badge-virtualserver">VirtualServer CRD</span> <code>rewritePath</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="approach-tabs">
                                <button class="approach-tab active" onclick="switchApproach(this, 'annotation')">Annotation Approach</button>
                                <button class="approach-tab" onclick="switchApproach(this, 'crd')">CRD Approach</button>
                            </div>
                            <div class="approach-content active" data-approach="annotation">
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/rewrite-target: /$2
  nginx.ingress.kubernetes.io/use-regex: "true"
# path: /api(/|$)(.*)</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/rewrites: "serviceName=api-svc rewrite=/api"
  nginx.org/path-regex: "case_sensitive"</code></pre></div>
                                </div>
                            </div>
                            <div class="approach-content" data-approach="crd">
                                <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                    <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                                </div>
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/rewrite-target: /$2
  nginx.ingress.kubernetes.io/use-regex: "true"
# path: /api(/|$)(.*)</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  routes:
    - path: ~ ^/api(/|$)(.*)
      action:
        proxy:
          upstream: api
          rewritePath: /$2</code></pre></div>
                                </div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/proxy-redirect-from</code><code>nginx.ingress.kubernetes.io/proxy-redirect-to</code></div></td>
                            <td><span class="badge badge-configmap">ConfigMap</span> or <span class="badge badge-annotation">Annotation</span> <code>nginx.org/server-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-redirect-from: "http://internal/"
  nginx.ingress.kubernetes.io/proxy-redirect-to: "https://external/"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/server-snippets: |
    proxy_redirect http://internal/ https://external/;</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Route Delegation -->
            <h3 id="route-delegation">Route Delegation</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><em>N/A</em></td>
                            <td><span class="badge badge-virtualserverroute">VirtualServerRoute CRD</span> <code>routes[].route</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box">
                                <h6>Install Required CRDs <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml
kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualserverroutes.yaml</code></pre>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The community controller has no equivalent for cross-namespace route delegation. VirtualServerRoute allows different teams to manage their own routing rules while a central VirtualServer controls the domain.</div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No equivalent — each team must have
# their own Ingress resource per host,
# or share a single Ingress manifest</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># VirtualServer (platform team)
apiVersion: k8s.nginx.org/v1
kind: VirtualServer
metadata:
  name: main-app
  namespace: platform
spec:
  host: app.example.com
  routes:
    - path: /api
      route: api-team/api-routes
    - path: /web
      route: web-team/web-routes
---
# VirtualServerRoute (API team)
apiVersion: k8s.nginx.org/v1
kind: VirtualServerRoute
metadata:
  name: api-routes
  namespace: api-team
spec:
  host: app.example.com
  upstreams:
    - name: api-v1
      service: api-v1-service
      port: 80
  subroutes:
    - path: /api/v1
      action:
        pass: api-v1</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- SSL/TLS -->
            <h3 id="ssl-tls">SSL/TLS</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/backend-protocol</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/ssl-services</code> or <code>nginx.org/grpc-services</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/ssl-services: "my-service"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> For gRPC backends, use <code>nginx.org/grpc-services: "my-service"</code> instead.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/force-ssl-redirect</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/redirect-to-https</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/force-ssl-redirect: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/redirect-to-https: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/ssl-ciphers</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/ssl-ciphers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/ssl-ciphers: "HIGH:!aNULL:!MD5"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/ssl-ciphers: "HIGH:!aNULL:!MD5"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/ssl-prefer-server-ciphers</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/ssl-prefer-server-ciphers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/ssl-prefer-server-ciphers: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/ssl-prefer-server-ciphers: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/ssl-redirect</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/redirect-to-https</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/ssl-redirect: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/redirect-to-https: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/ssl-passthrough</code></td>
                            <td><span class="badge badge-transportserver">TransportServer CRD</span> <code>TLS_PASSTHROUGH</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install TransportServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_transportservers.yaml
kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_globalconfigurations.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/ssl-passthrough: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># GlobalConfiguration (once per cluster)
apiVersion: k8s.nginx.org/v1
kind: GlobalConfiguration
spec:
  listeners:
    - name: tls-passthrough
      port: 443
      protocol: TLS_PASSTHROUGH
---
apiVersion: k8s.nginx.org/v1
kind: TransportServer
spec:
  listener:
    name: tls-passthrough
    protocol: TLS_PASSTHROUGH
  host: secure.example.com
  upstreams:
    - name: backend
      service: secure-svc
      port: 443
  action:
    pass: backend</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- TCP/UDP -->
            <h3 id="tcp-udp">TCP/UDP Load Balancing</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/stream-snippet</code><code>tcp-services ConfigMap</code><code>udp-services ConfigMap</code></div></td>
                            <td><span class="badge badge-transportserver">TransportServer CRD</span></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install TransportServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_transportservers.yaml
kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_globalconfigurations.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># ConfigMap for TCP services
apiVersion: v1
kind: ConfigMap
metadata:
  name: tcp-services
data:
  3306: "default/mysql:3306"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># GlobalConfiguration
apiVersion: k8s.nginx.org/v1
kind: GlobalConfiguration
spec:
  listeners:
    - name: mysql-tcp
      port: 3306
      protocol: TCP
---
apiVersion: k8s.nginx.org/v1
kind: TransportServer
spec:
  listener:
    name: mysql-tcp
    protocol: TCP
  upstreams:
    - name: mysql
      service: mysql
      port: 3306
  action:
    pass: mysql</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Timeouts -->
            <h3 id="timeouts">Timeouts</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-connect-timeout</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-connect-timeout</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-connect-timeout: "10"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-connect-timeout: "10s"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-read-timeout</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-read-timeout</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-read-timeout: "60"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-read-timeout: "60s"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-send-timeout</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-send-timeout</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-send-timeout: "60"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-send-timeout: "60s"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Upstream Configuration -->
            <h3 id="upstream-configuration">Upstream Configuration</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/fail-timeout</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/keepalive</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/max-conns</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/max-fails</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/upstream-zone-size</code></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="info-box note"><strong>Note:</strong> These are Official NGINX-only annotations for fine-tuning upstream behavior. The community controller does not provide per-annotation control over these settings.</div>
        </section>

        <!-- Plus Mappings -->
        <section id="plus-mappings">
            <h2 id="plus-mappings">NGINX Plus Mappings</h2>
            <p>These features require an NGINX Plus subscription and provide enterprise-grade capabilities. Most Plus features use CRD-based configuration—click the expandable rows <span style="color: var(--primary-color);">▶</span> to see full examples.</p>

            <div class="legend">
                <div class="legend-item"><span class="badge badge-plus">Plus Required</span></div>
                <div class="legend-item"><span class="badge badge-annotation">Annotation</span></div>
                <div class="legend-item"><span class="badge badge-virtualserver">VirtualServer CRD</span></div>
                <div class="legend-item"><span class="badge badge-virtualserverroute">VirtualServerRoute CRD</span></div>
                <div class="legend-item"><span class="badge badge-policy">Policy CRD</span></div>
            </div>

            <!-- API Key Authentication -->
            <h3 id="api-key-authentication">API Key Authentication</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>No direct equivalent</code></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <span class="badge badge-plus">Plus</span> <code>apiKey</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No direct equivalent
# Requires custom Lua or external service</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: v1
kind: Secret
metadata:
  name: api-keys
type: nginx.org/apikey
data:
  client1: YXBpa2V5MTIzNDU=
---
apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: api-key-auth
spec:
  apiKey:
    suppliedIn:
      header: [X-API-Key]
      query: [api_key]
    clientSecret: api-keys</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Health Checks -->
            <h3 id="health-checks">Health Checks</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>No direct equivalent</code><em>(passive only)</em></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <span class="badge badge-plus">Plus</span> <code>upstreams[].healthCheck</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No active health check equivalent
# Only passive health checks available</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: backend
      service: my-service
      port: 80
      healthCheck:
        enable: true
        path: /health
        interval: 5s
        jitter: 2s
        fails: 3
        passes: 2
        port: 8080
        statusMatch: "200-399"
        mandatory: true
        persistent: true</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> Related annotations: <code>nginx.com/health-checks</code>, <code>nginx.com/health-checks-mandatory</code>, <code>nginx.com/slow-start</code>. Active health checks require NGINX Plus.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- JWT Authentication -->
            <h3 id="jwt-authentication">JWT Authentication</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>No direct equivalent</code></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <span class="badge badge-plus">Plus</span> <code>jwt</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No direct equivalent
# Requires external auth service</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: jwt-auth
spec:
  jwt:
    realm: "API"
    jwksURI: "https://idp.example.com/.well-known/jwks.json"
    token: "$http_authorization"
    keyCache: 1h</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- OIDC Authentication -->
            <h3 id="oidc-authentication">OIDC Authentication</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/auth-cache-duration</code><code>nginx.ingress.kubernetes.io/auth-cache-key</code><code>nginx.ingress.kubernetes.io/auth-method</code><code>nginx.ingress.kubernetes.io/auth-proxy-set-headers</code><code>nginx.ingress.kubernetes.io/auth-request-redirect</code><code>nginx.ingress.kubernetes.io/auth-response-headers</code><code>nginx.ingress.kubernetes.io/auth-signin</code><code>nginx.ingress.kubernetes.io/auth-signin-redirect-param</code><code>nginx.ingress.kubernetes.io/auth-url</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <span class="badge badge-plus">Plus</span> <code>oidc</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/auth-url: "https://auth.example.com/oauth2/auth"
  nginx.ingress.kubernetes.io/auth-signin: "https://auth.example.com/oauth2/start"
  nginx.ingress.kubernetes.io/auth-response-headers: "X-Auth-User"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: v1
kind: Secret
metadata:
  name: oidc-secret
type: nginx.org/oidc
data:
  client-secret: c2VjcmV0...
---
apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: oidc-auth
spec:
  oidc:
    clientID: "my-client-id"
    clientSecret: oidc-secret
    authEndpoint: "https://idp.example.com/authorize"
    tokenEndpoint: "https://idp.example.com/token"
    jwksURI: "https://idp.example.com/.well-known/jwks.json"
    scope: "openid+profile+email"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> Native OIDC support eliminates the need for oauth2-proxy sidecar.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Session Affinity -->
            <h3 id="session-affinity">Session Affinity / Sticky Sessions</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/affinity: "cookie"</code><code>nginx.ingress.kubernetes.io/affinity-mode</code><code>nginx.ingress.kubernetes.io/session-cookie-change-on-failure</code><code>nginx.ingress.kubernetes.io/session-cookie-conditional-samesite-none</code><code>nginx.ingress.kubernetes.io/session-cookie-domain</code><code>nginx.ingress.kubernetes.io/session-cookie-expires</code><code>nginx.ingress.kubernetes.io/session-cookie-max-age</code><code>nginx.ingress.kubernetes.io/session-cookie-name</code><code>nginx.ingress.kubernetes.io/session-cookie-path</code><code>nginx.ingress.kubernetes.io/session-cookie-samesite</code><code>nginx.ingress.kubernetes.io/session-cookie-secure</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <span class="badge badge-plus">Plus</span> <code>sessionCookie</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/affinity: "cookie"
  nginx.ingress.kubernetes.io/session-cookie-name: "SERVERID"
  nginx.ingress.kubernetes.io/session-cookie-expires: "172800"
  nginx.ingress.kubernetes.io/session-cookie-path: "/"
  nginx.ingress.kubernetes.io/session-cookie-secure: "true"
  nginx.ingress.kubernetes.io/session-cookie-samesite: "Strict"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: backend
      service: my-service
      port: 80
      sessionCookie:
        enable: true
        name: SERVERID
        expires: 48h
        path: /
        secure: true
        httpOnly: true
        samesite: strict</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- WAF -->
            <h3 id="waf">WAF (Web Application Firewall)</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/enable-modsecurity</code><code>nginx.ingress.kubernetes.io/enable-owasp-core-rules</code><code>nginx.ingress.kubernetes.io/modsecurity-snippet</code><code>nginx.ingress.kubernetes.io/modsecurity-transaction-id</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <span class="badge badge-plus">Plus</span> <code>waf</code> (NGINX App Protect)</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/enable-modsecurity: "true"
  nginx.ingress.kubernetes.io/enable-owasp-core-rules: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: waf-policy
spec:
  waf:
    enable: true
    apPolicy: "default/waf-policy"
    securityLogs:
      - enable: true
        apLogConf: "default/log-config"
        logDest: "syslog:server=syslog:514"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> NGINX App Protect (NAP) provides enterprise WAF capabilities beyond ModSecurity.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- CRD Features Summary -->
        <section id="features">
            <h2 id="crd-features">CRD Features Summary</h2>
            <p>The Official NGINX Ingress Controller uses Custom Resource Definitions (CRDs) to extend Kubernetes with NGINX-specific configuration. CRDs provide type-safe, validated configuration that goes beyond what standard Ingress annotations can offer.</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4><span class="badge badge-virtualserver" style="margin:0 8px 0 0">VirtualServer CRD</span> VirtualServer</h4>
                    <p class="description">The primary CRD for configuring HTTP/HTTPS load balancing. It replaces Ingress resources and provides advanced traffic management capabilities with full validation.</p>
                    <ul>
                        <li><strong>Traffic Splitting:</strong> Route percentages of traffic to different backends for canary/blue-green deployments</li>
                        <li><strong>Content-Based Routing:</strong> Route based on headers, cookies, arguments, or variables</li>
                        <li><strong>Path Rewriting:</strong> Modify request URIs with regex support before forwarding to backends</li>
                        <li><strong>Error Pages:</strong> Custom responses for specific HTTP error codes</li>
                        <li><strong>Request/Response Headers:</strong> Add, modify, or remove headers in transit</li>
                        <li><strong>Health Checks:</strong> Active health monitoring of upstream servers</li>
                        <li><strong>Session Persistence:</strong> Cookie-based sticky sessions (Plus)</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4><span class="badge badge-virtualserverroute" style="margin:0 8px 0 0">VirtualServerRoute CRD</span> VirtualServerRoute</h4>
                    <p class="description">Enables delegation of route configuration to different namespaces. Allows teams to manage their own routing rules while maintaining centralized control over the domain.</p>
                    <ul>
                        <li><strong>Cross-Namespace Routing:</strong> Reference services in different namespaces</li>
                        <li><strong>Path Delegation:</strong> Delegate path prefixes to other teams/namespaces</li>
                        <li><strong>Independent Updates:</strong> Teams update routes without modifying the parent VirtualServer</li>
                        <li><strong>Access Control:</strong> Limit which namespaces can define routes for a host</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4><span class="badge badge-policy" style="margin:0 8px 0 0">Policy CRD</span> Policy</h4>
                    <p class="description">Reusable security and traffic policies that can be attached to VirtualServers or specific routes. Policies enable consistent security controls across multiple applications.</p>
                    <ul>
                        <li><strong>Rate Limiting:</strong> Limit request rates by IP, header, or custom key</li>
                        <li><strong>Access Control:</strong> IP allowlists and denylists</li>
                        <li><strong>Basic Auth:</strong> Username/password authentication via htpasswd</li>
                        <li><strong>JWT Validation:</strong> Validate JSON Web Tokens (Plus)</li>
                        <li><strong>OIDC:</strong> Native OpenID Connect integration (Plus)</li>
                        <li><strong>API Key Auth:</strong> Authenticate via API keys in headers/query (Plus)</li>
                        <li><strong>mTLS:</strong> Client certificate verification (ingress) and backend TLS (egress)</li>
                        <li><strong>WAF:</strong> NGINX App Protect web application firewall (Plus)</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4><span class="badge badge-transportserver" style="margin:0 8px 0 0">TransportServer CRD</span> TransportServer</h4>
                    <p class="description">Configures TCP/UDP load balancing for non-HTTP protocols. Essential for databases, message queues, gaming servers, and other Layer 4 applications.</p>
                    <ul>
                        <li><strong>TCP Load Balancing:</strong> MySQL, PostgreSQL, Redis, custom TCP services</li>
                        <li><strong>UDP Load Balancing:</strong> DNS, RADIUS, gaming protocols</li>
                        <li><strong>TLS Passthrough:</strong> Pass encrypted traffic directly to backends</li>
                        <li><strong>Health Checks:</strong> TCP/UDP health monitoring</li>
                        <li><strong>Session Persistence:</strong> IP hash-based session affinity</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4><span class="badge badge-globalconfiguration" style="margin:0 8px 0 0">GlobalConfiguration CRD</span> GlobalConfiguration</h4>
                    <p class="description">Cluster-wide configuration for the NGINX Ingress Controller. Defines global listeners for TCP/UDP and TLS passthrough that TransportServers can reference.</p>
                    <ul>
                        <li><strong>TCP/UDP Listeners:</strong> Define ports for non-HTTP traffic</li>
                        <li><strong>TLS Passthrough Listeners:</strong> Configure SNI-based routing</li>
                        <li><strong>Global Settings:</strong> Controller-wide configuration options</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Installation -->
        <section id="installation">
            <h2 id="installing-crds">Installing CRDs</h2>
            <div class="install-box"><h6>Install All CRDs</h6>
                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds.yaml</code></pre>
            </div>
            <h3 id="install-individually">Or Install Individually</h3>
            <pre><code># VirtualServer and VirtualServerRoute
kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualservers.yaml
kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_virtualserverroutes.yaml

# Policy
kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_policies.yaml

# TransportServer and GlobalConfiguration
kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_transportservers.yaml
kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v3.4.0/deploy/crds/k8s.nginx.org_globalconfigurations.yaml</code></pre>
            <div class="info-box note"><strong>Note:</strong> Replace <code>v3.4.0</code> with your controller version.</div>
        </section>

        <!-- Checklist -->
        <section id="checklist">
            <h2 id="migration-checklist">Migration Checklist</h2>
            <ul class="checklist">
                <li>Install CRDs (VirtualServer, Policy, TransportServer, GlobalConfiguration)</li>
                <li>Change annotation prefix from <code>nginx.ingress.kubernetes.io/</code> to <code>nginx.org/</code></li>
                <li>Convert access control annotations to Policy CRD</li>
                <li>Convert authentication to Policy CRD (basicAuth, jwt, oidc, apiKey)</li>
                <li>Convert canary/traffic splitting to VirtualServer splits/matches</li>
                <li>Convert mTLS to ingressMTLS/egressMTLS policies</li>
                <li>Convert rate limiting to Policy CRD</li>
                <li>Convert session affinity to VirtualServer sessionCookie</li>
                <li>Convert SSL passthrough to TransportServer</li>
                <li>Convert TCP/UDP services to TransportServer</li>
                <li>Test in staging environment</li>
                <li>Update monitoring and alerting</li>
            </ul>
        </section>

        <!-- Resources -->
        <section id="resources">
            <h2 id="additional-resources">Additional Resources</h2>
            <ul>
                <li><a href="https://docs.nginx.com/nginx-ingress-controller/" target="_blank">Official Documentation</a></li>
                <li><a href="https://docs.nginx.com/nginx-ingress-controller/configuration/virtualserver-and-virtualserverroute-resources/" target="_blank">VirtualServer Reference</a></li>
                <li><a href="https://docs.nginx.com/nginx-ingress-controller/configuration/policy-resource/" target="_blank">Policy Reference</a></li>
                <li><a href="https://docs.nginx.com/nginx-ingress-controller/configuration/transportserver-resource/" target="_blank">TransportServer Reference</a></li>
                <li><a href="https://github.com/nginx/kubernetes-ingress" target="_blank">GitHub Repository</a></li>
                <li><a href="https://github.com/alessfg/nginx-ingress-migration-guide" target="_blank">Contribute to This Guide</a></li>
            </ul>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>NGINX Ingress Migration Guide</p>
            <p><a href="https://github.com/nginx/kubernetes-ingress" target="_blank">Official NGINX Ingress on GitHub</a> · <a href="https://github.com/alessfg/nginx-ingress-migration-guide" target="_blank">Contribute to This Guide</a></p>
        </div>
    </footer>

    <script>
        function toggleRow(row) {
            const exampleRow = row.nextElementSibling;
            if (exampleRow && exampleRow.classList.contains('example-row')) {
                row.classList.toggle('expanded');
                exampleRow.classList.toggle('visible');
            }
        }
        function expandAllExamples() {
            document.querySelectorAll('.expandable').forEach(row => {
                row.classList.add('expanded');
                const exampleRow = row.nextElementSibling;
                if (exampleRow && exampleRow.classList.contains('example-row')) exampleRow.classList.add('visible');
            });
        }
        function collapseAllExamples() {
            document.querySelectorAll('.expandable').forEach(row => {
                row.classList.remove('expanded');
                const exampleRow = row.nextElementSibling;
                if (exampleRow && exampleRow.classList.contains('example-row')) exampleRow.classList.remove('visible');
            });
        }
        function filterTable() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.mapping-table').forEach(table => {
                let visibleCount = 0;
                table.querySelectorAll('tbody tr').forEach(row => {
                    if (row.classList.contains('example-row')) {
                        if (term) { row.classList.remove('visible'); row.previousElementSibling?.classList.remove('expanded'); }
                        return;
                    }
                    const match = !term || row.textContent.toLowerCase().includes(term);
                    row.style.display = match ? '' : 'none';
                    if (match) visibleCount++;
                });
                const wrapper = table.closest('.table-wrapper');
                if (!wrapper) return;
                const h3 = wrapper.previousElementSibling;
                const infoBox = wrapper.nextElementSibling;
                const hidden = term && visibleCount === 0;
                wrapper.style.display = hidden ? 'none' : '';
                if (h3 && h3.tagName === 'H3') h3.style.display = hidden ? 'none' : '';
                if (infoBox && infoBox.classList.contains('info-box')) infoBox.style.display = hidden ? 'none' : '';
            });
        }
        function switchApproach(btn, type) {
            const container = btn.closest('.example-content');
            container.querySelectorAll('.approach-tab').forEach(t => t.classList.remove('active'));
            container.querySelectorAll('.approach-content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            container.querySelector('.approach-content[data-approach="' + type + '"]').classList.add('active');
        }
        function copyInstall(btn, e) {
            e.stopPropagation();
            const code = btn.parentElement.nextElementSibling.textContent;
            navigator.clipboard.writeText(code).then(() => {
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
            });
        }
        document.querySelectorAll('nav a').forEach(a => {
            a.addEventListener('click', e => {
                e.preventDefault();
                document.querySelector(a.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
            });
        });
        document.querySelectorAll('h2[id], h3[id]').forEach(heading => {
            const anchor = document.createElement('a');
            anchor.className = 'heading-anchor';
            anchor.href = '#' + heading.id;
            anchor.setAttribute('aria-label', 'Permalink: ' + heading.textContent.trim());
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '16');
            svg.setAttribute('height', '16');
            svg.setAttribute('viewBox', '0 0 16 16');
            svg.setAttribute('fill', 'currentColor');
            svg.setAttribute('aria-hidden', 'true');
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', 'm7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z');
            svg.appendChild(path);
            anchor.appendChild(svg);
            heading.appendChild(anchor);
        });

        // --- YAML Migration Analyzer ---
        const ANNOTATION_MAPPINGS = [
            // Access Control
            { community: ["denylist-source-range", "whitelist-source-range"], official: "Policy CRD accessControl", type: "policy", category: "Access Control", anchor: "access-control", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["satisfy"], official: "Annotation nginx.org/location-snippets (satisfy directive)", type: "annotation", category: "Access Control", anchor: "access-control", section: "oss", dualApproach: false, plusRequired: false },
            // Authentication (Basic)
            { community: ["auth-realm", "auth-secret", "auth-secret-type", "auth-type"], official: "Annotation nginx.org/basic-auth-* or Policy CRD basicAuth", type: "policy", category: "Authentication (Basic)", anchor: "authentication-basic", section: "oss", dualApproach: true, plusRequired: false },
            // Buffering
            { community: ["client-body-buffer-size"], official: "Annotation nginx.org/client-body-buffer-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-body-size"], official: "Annotation nginx.org/client-max-body-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-buffer-size"], official: "Annotation nginx.org/proxy-buffer-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-buffering"], official: "Annotation nginx.org/proxy-buffering", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-buffers-number"], official: "Annotation nginx.org/proxy-buffers", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-busy-buffers-size"], official: "Annotation nginx.org/proxy-busy-buffers-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-max-temp-file-size"], official: "Annotation nginx.org/proxy-max-temp-file-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-request-buffering"], official: "ConfigMap proxy-request-buffering", type: "configmap", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false },
            // Canary / Traffic Splitting
            { community: ["canary", "canary-by-cookie", "canary-by-header", "canary-by-header-pattern", "canary-by-header-value", "canary-weight", "canary-weight-total"], official: "VirtualServer CRD splits[]/matches[]", type: "virtualserver", category: "Canary / Traffic Splitting", anchor: "canary-traffic-splitting", section: "oss", dualApproach: false, plusRequired: false },
            // Configuration Snippets
            { community: ["configuration-snippet"], official: "Annotation nginx.org/location-snippets", type: "annotation", category: "Configuration Snippets", anchor: "configuration-snippets", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["server-snippet"], official: "Annotation nginx.org/server-snippets", type: "annotation", category: "Configuration Snippets", anchor: "configuration-snippets", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["stream-snippet"], official: "TransportServer CRD or GlobalConfiguration", type: "transportserver", category: "Configuration Snippets", anchor: "configuration-snippets", section: "oss", dualApproach: false, plusRequired: false },
            // CORS
            { community: ["cors-allow-credentials", "cors-allow-headers", "cors-allow-methods", "cors-allow-origin", "cors-expose-headers", "cors-max-age", "enable-cors"], official: "Annotation nginx.org/server-snippets or location-snippets (CORS headers)", type: "annotation", category: "CORS", anchor: "cors", section: "oss", dualApproach: false, plusRequired: false },
            // Error Handling
            { community: ["custom-http-errors", "default-backend"], official: "VirtualServer CRD errorPages[]", type: "virtualserver", category: "Error Handling", anchor: "error-handling", section: "oss", dualApproach: false, plusRequired: false },
            // Headers
            { community: ["connection-proxy-header"], official: "Snippets or ConfigMap", type: "configmap", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["custom-headers"], official: "VirtualServer CRD responseHeaders.add", type: "virtualserver", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-hide-headers"], official: "Annotation nginx.org/proxy-hide-headers", type: "annotation", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-pass-headers"], official: "Annotation nginx.org/proxy-pass-headers", type: "annotation", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["upstream-vhost", "x-forwarded-prefix"], official: "VirtualServer CRD requestHeaders.set", type: "virtualserver", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false },
            // Load Balancing
            { community: ["load-balance"], official: "Annotation nginx.org/lb-method", type: "annotation", category: "Load Balancing", anchor: "load-balancing", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["service-upstream"], official: "Annotation nginx.org/use-cluster-ip", type: "annotation", category: "Load Balancing", anchor: "load-balancing", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["upstream-hash-by", "upstream-hash-by-subset", "upstream-hash-by-subset-size"], official: "VirtualServer CRD upstreams[].lb-method", type: "virtualserver", category: "Load Balancing", anchor: "load-balancing", section: "oss", dualApproach: false, plusRequired: false },
            // mTLS (Client)
            { community: ["auth-tls-error-page", "auth-tls-pass-certificate-to-upstream", "auth-tls-secret", "auth-tls-verify-client", "auth-tls-verify-depth"], official: "Policy CRD ingressMTLS", type: "policy", category: "mTLS (Client)", anchor: "mtls-client", section: "oss", dualApproach: false, plusRequired: false },
            // mTLS (Backend)
            { community: ["proxy-ssl-ciphers", "proxy-ssl-protocols", "proxy-ssl-secret", "proxy-ssl-server-name", "proxy-ssl-verify", "proxy-ssl-verify-depth"], official: "Policy CRD egressMTLS", type: "policy", category: "mTLS (Backend)", anchor: "mtls-backend", section: "oss", dualApproach: false, plusRequired: false },
            // Miscellaneous
            { community: ["enable-access-log"], official: "ConfigMap access-log-off", type: "configmap", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["enable-opentelemetry"], official: "ConfigMap OpenTelemetry settings", type: "configmap", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["http2-push-preload"], official: "ConfigMap http2-push-preload", type: "configmap", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["mirror-target"], official: "Annotation nginx.org/location-snippets with mirror directive", type: "annotation", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-http-version"], official: "ConfigMap proxy-protocol", type: "configmap", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["server-alias"], official: "Create additional VirtualServer resources", type: "virtualserver", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["server-tokens"], official: "Annotation nginx.org/server-tokens", type: "annotation", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["websocket-services"], official: "Annotation nginx.org/websocket-services", type: "annotation", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false },
            // Proxy Settings
            { community: ["proxy-next-upstream", "proxy-next-upstream-timeout", "proxy-next-upstream-tries"], official: "VirtualServer CRD upstreams[].next-upstream*", type: "virtualserver", category: "Proxy Settings", anchor: "proxy-settings", section: "oss", dualApproach: false, plusRequired: false },
            // Rate Limiting
            { community: ["limit-burst-multiplier", "limit-connections", "limit-rate", "limit-rate-after", "limit-rpm", "limit-rps", "limit-whitelist"], official: "Annotation nginx.org/limit-req-* or Policy CRD rateLimit", type: "policy", category: "Rate Limiting", anchor: "rate-limiting", section: "oss", dualApproach: true, plusRequired: false },
            // Redirects
            { community: ["from-to-www-redirect", "permanent-redirect", "permanent-redirect-code", "temporal-redirect"], official: "VirtualServer CRD action.redirect", type: "virtualserver", category: "Redirects", anchor: "redirects", section: "oss", dualApproach: false, plusRequired: false },
            // Rewrites
            { community: ["app-root", "rewrite-target", "use-regex"], official: "Annotation nginx.org/rewrites or VirtualServer CRD rewritePath", type: "virtualserver", category: "Rewrites", anchor: "rewrites", section: "oss", dualApproach: true, plusRequired: false },
            { community: ["proxy-redirect-from", "proxy-redirect-to"], official: "ConfigMap or Annotation nginx.org/server-snippets", type: "configmap", category: "Rewrites", anchor: "rewrites", section: "oss", dualApproach: false, plusRequired: false },
            // SSL/TLS
            { community: ["backend-protocol"], official: "Annotation nginx.org/ssl-services or nginx.org/grpc-services", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["force-ssl-redirect"], official: "Annotation nginx.org/redirect-to-https", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["ssl-ciphers"], official: "Annotation nginx.org/ssl-ciphers", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["ssl-prefer-server-ciphers"], official: "Annotation nginx.org/ssl-prefer-server-ciphers", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["ssl-redirect"], official: "Annotation nginx.org/redirect-to-https", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["ssl-passthrough"], official: "TransportServer CRD TLS_PASSTHROUGH", type: "transportserver", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false },
            // Timeouts
            { community: ["proxy-connect-timeout"], official: "Annotation nginx.org/proxy-connect-timeout", type: "annotation", category: "Timeouts", anchor: "timeouts", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-read-timeout"], official: "Annotation nginx.org/proxy-read-timeout", type: "annotation", category: "Timeouts", anchor: "timeouts", section: "oss", dualApproach: false, plusRequired: false },
            { community: ["proxy-send-timeout"], official: "Annotation nginx.org/proxy-send-timeout", type: "annotation", category: "Timeouts", anchor: "timeouts", section: "oss", dualApproach: false, plusRequired: false },
            // Plus: OIDC
            { community: ["auth-cache-duration", "auth-cache-key", "auth-method", "auth-proxy-set-headers", "auth-request-redirect", "auth-response-headers", "auth-signin", "auth-signin-redirect-param", "auth-url"], official: "Policy CRD oidc", type: "policy", category: "OIDC Authentication", anchor: "oidc-authentication", section: "plus", dualApproach: false, plusRequired: true },
            // Plus: Session Affinity
            { community: ["affinity", "affinity-mode", "session-cookie-change-on-failure", "session-cookie-conditional-samesite-none", "session-cookie-domain", "session-cookie-expires", "session-cookie-max-age", "session-cookie-name", "session-cookie-path", "session-cookie-samesite", "session-cookie-secure"], official: "VirtualServer CRD sessionCookie", type: "virtualserver", category: "Session Affinity", anchor: "session-affinity", section: "plus", dualApproach: false, plusRequired: true },
            // Plus: WAF
            { community: ["enable-modsecurity", "enable-owasp-core-rules", "modsecurity-snippet", "modsecurity-transaction-id"], official: "Policy CRD waf (NGINX App Protect)", type: "policy", category: "WAF", anchor: "waf", section: "plus", dualApproach: false, plusRequired: true }
        ];

        const ANNOTATION_LOOKUP = new Map();
        ANNOTATION_MAPPINGS.forEach(function(mapping, idx) {
            mapping.community.forEach(function(name) {
                ANNOTATION_LOOKUP.set(name, idx);
            });
        });

        function parseYamlAnnotations(yamlText) {
            var results = [];
            var docs = yamlText.split(/^---\s*$/m);
            docs.forEach(function(doc, docIndex) {
                var lines = doc.split('\n');
                var inAnnotations = false;
                var annotationIndent = -1;
                for (var i = 0; i < lines.length; i++) {
                    var line = lines[i];
                    var trimmed = line.trimStart();
                    if (trimmed.startsWith('#') || trimmed === '') continue;
                    var currentIndent = line.length - line.trimStart().length;
                    if (/^\s*annotations\s*:/.test(line)) {
                        var inlineMatch = line.match(/annotations\s*:\s*\{(.+)\}/);
                        if (inlineMatch) {
                            var pairs = inlineMatch[1].split(',');
                            pairs.forEach(function(pair) {
                                var kv = pair.split(':');
                                if (kv.length >= 2) {
                                    var key = kv[0].trim().replace(/^["']|["']$/g, '');
                                    var val = kv.slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                                    if (key.startsWith('nginx.ingress.kubernetes.io/')) {
                                        results.push({ annotation: key.replace('nginx.ingress.kubernetes.io/', ''), value: val, docIndex: docIndex });
                                    }
                                }
                            });
                            inAnnotations = false;
                            continue;
                        }
                        inAnnotations = true;
                        annotationIndent = currentIndent;
                        continue;
                    }
                    if (inAnnotations) {
                        if (currentIndent <= annotationIndent && trimmed !== '') {
                            inAnnotations = false;
                            annotationIndent = -1;
                            continue;
                        }
                        var kvMatch = trimmed.match(/^["']?([^"':]+)["']?\s*:\s*(.*)$/);
                        if (kvMatch) {
                            var key = kvMatch[1].trim().replace(/^["']|["']$/g, '');
                            var val = kvMatch[2].trim().replace(/^["']|["']$/g, '');
                            if (key.startsWith('nginx.ingress.kubernetes.io/')) {
                                results.push({ annotation: key.replace('nginx.ingress.kubernetes.io/', ''), value: val, docIndex: docIndex });
                            }
                        }
                    }
                }
            });
            return results;
        }

        function escapeHtml(str) {
            var d = document.createElement('div');
            d.textContent = str;
            return d.innerHTML;
        }

        function analyzeYaml() {
            var yamlText = document.getElementById('yamlInput').value.trim();
            var resultsDiv = document.getElementById('analyzerResults');
            if (!yamlText) {
                showAnalyzerMessage(resultsDiv, 'error', 'No input.', 'Paste a Kubernetes Ingress YAML manifest to analyze.');
                return;
            }
            var annotations = parseYamlAnnotations(yamlText);
            if (annotations.length === 0) {
                showAnalyzerMessage(resultsDiv, 'info', 'No community NGINX annotations found.', 'Make sure your YAML contains annotations with the nginx.ingress.kubernetes.io/ prefix.');
                return;
            }
            var matchedMappings = new Map();
            var unrecognized = [];
            annotations.forEach(function(ann) {
                var idx = ANNOTATION_LOOKUP.get(ann.annotation);
                if (idx !== undefined) {
                    if (!matchedMappings.has(idx)) {
                        matchedMappings.set(idx, { mapping: ANNOTATION_MAPPINGS[idx], foundAnnotations: [] });
                    }
                    var entry = matchedMappings.get(idx);
                    if (!entry.foundAnnotations.some(function(a) { return a.annotation === ann.annotation; })) {
                        entry.foundAnnotations.push({ annotation: ann.annotation, value: ann.value });
                    }
                } else {
                    if (!unrecognized.some(function(u) { return u.annotation === ann.annotation; })) {
                        unrecognized.push(ann);
                    }
                }
            });
            var typeOrder = { policy: 0, virtualserver: 1, virtualserverroute: 2, transportserver: 3, globalconfiguration: 4, annotation: 5, configmap: 6 };
            var sorted = Array.from(matchedMappings.values()).sort(function(a, b) {
                var ta = typeOrder[a.mapping.type] !== undefined ? typeOrder[a.mapping.type] : 99;
                var tb = typeOrder[b.mapping.type] !== undefined ? typeOrder[b.mapping.type] : 99;
                if (ta !== tb) return ta - tb;
                return a.mapping.category.localeCompare(b.mapping.category);
            });
            var crdCount = sorted.filter(function(e) { return e.mapping.type !== 'annotation' && e.mapping.type !== 'configmap'; }).length;
            renderAnalyzerResults(resultsDiv, annotations.length, sorted, crdCount, unrecognized);
        }

        function showAnalyzerMessage(container, type, title, message) {
            var div = document.createElement('div');
            div.className = type === 'error' ? 'analyzer-error' : 'analyzer-info';
            var strong = document.createElement('strong');
            strong.textContent = title;
            div.appendChild(strong);
            div.appendChild(document.createTextNode(' ' + message));
            container.textContent = '';
            container.appendChild(div);
        }

        function renderAnalyzerResults(container, totalAnnotations, sorted, crdCount, unrecognized) {
            container.textContent = '';
            // Summary pills
            var summary = document.createElement('div');
            summary.className = 'analyzer-summary';
            function addPill(cls, text) {
                var span = document.createElement('span');
                span.className = 'analyzer-pill ' + cls;
                span.textContent = text;
                summary.appendChild(span);
            }
            addPill('found', totalAnnotations + ' annotation' + (totalAnnotations !== 1 ? 's' : '') + ' found');
            addPill('paths', sorted.length + ' migration path' + (sorted.length !== 1 ? 's' : ''));
            if (crdCount > 0) addPill('crds', crdCount + ' require CRDs');
            if (unrecognized.length > 0) addPill('unrecognized', unrecognized.length + ' unrecognized');
            container.appendChild(summary);
            // Cards
            var cardsDiv = document.createElement('div');
            cardsDiv.id = 'analyzerCards';
            sorted.forEach(function(entry) {
                var m = entry.mapping;
                var badgeLabel = m.type === 'annotation' ? 'Annotation' : m.type === 'configmap' ? 'ConfigMap' : m.type.charAt(0).toUpperCase() + m.type.slice(1) + ' CRD';
                var card = document.createElement('div');
                card.className = 'analyzer-card type-' + m.type;
                // Header
                var header = document.createElement('div');
                header.className = 'analyzer-card-header';
                var foundDiv = document.createElement('div');
                foundDiv.className = 'found-annotations';
                entry.foundAnnotations.forEach(function(a) {
                    var code = document.createElement('code');
                    code.textContent = 'nginx.ingress.kubernetes.io/' + a.annotation;
                    foundDiv.appendChild(code);
                    if (a.value) {
                        var valSpan = document.createElement('span');
                        valSpan.className = 'annotation-value';
                        valSpan.textContent = '= ' + a.value;
                        foundDiv.appendChild(valSpan);
                        foundDiv.appendChild(document.createTextNode(' '));
                    }
                });
                header.appendChild(foundDiv);
                var badge = document.createElement('span');
                badge.className = 'badge badge-' + m.type;
                badge.textContent = badgeLabel;
                header.appendChild(badge);
                if (m.plusRequired) {
                    var plusSpan = document.createElement('span');
                    plusSpan.className = 'plus-indicator';
                    plusSpan.textContent = 'Plus Required';
                    header.appendChild(plusSpan);
                }
                card.appendChild(header);
                // Body
                var body = document.createElement('div');
                body.className = 'analyzer-card-body';
                var arrow = document.createElement('span');
                arrow.className = 'migration-arrow';
                arrow.textContent = '\u2192';
                body.appendChild(arrow);
                body.appendChild(document.createTextNode(' ' + m.official));
                if (m.dualApproach) {
                    var em = document.createElement('em');
                    em.textContent = ' (dual approach: annotation or CRD)';
                    body.appendChild(em);
                }
                card.appendChild(body);
                // Footer
                var footer = document.createElement('div');
                footer.className = 'analyzer-card-footer';
                var catLabel = document.createElement('span');
                catLabel.className = 'category-label';
                catLabel.textContent = m.category + ' (' + (m.section === 'oss' ? 'OSS' : 'Plus') + ')';
                footer.appendChild(catLabel);
                var link = document.createElement('a');
                link.href = '#' + m.anchor;
                link.textContent = 'View full migration example \u2192';
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    highlightSection(m.anchor);
                });
                footer.appendChild(link);
                card.appendChild(footer);
                cardsDiv.appendChild(card);
            });
            container.appendChild(cardsDiv);
            // Unrecognized
            if (unrecognized.length > 0) {
                var unrecSection = document.createElement('div');
                unrecSection.className = 'analyzer-unrecognized-section';
                var h4 = document.createElement('h4');
                h4.textContent = 'Unrecognized Annotations';
                unrecSection.appendChild(h4);
                var desc = document.createElement('p');
                desc.style.fontSize = '0.9rem';
                desc.style.color = '#666';
                desc.style.marginBottom = '10px';
                desc.textContent = 'These annotations were not found in the migration database. They may be custom, deprecated, or not yet mapped.';
                unrecSection.appendChild(desc);
                unrecognized.forEach(function(u) {
                    var uCard = document.createElement('div');
                    uCard.className = 'analyzer-card unrecognized';
                    var uHeader = document.createElement('div');
                    uHeader.className = 'analyzer-card-header';
                    var uFound = document.createElement('div');
                    uFound.className = 'found-annotations';
                    var uCode = document.createElement('code');
                    uCode.textContent = 'nginx.ingress.kubernetes.io/' + u.annotation;
                    uFound.appendChild(uCode);
                    if (u.value) {
                        var uVal = document.createElement('span');
                        uVal.className = 'annotation-value';
                        uVal.textContent = '= ' + u.value;
                        uFound.appendChild(uVal);
                    }
                    uHeader.appendChild(uFound);
                    uCard.appendChild(uHeader);
                    unrecSection.appendChild(uCard);
                });
                var contributeP = document.createElement('p');
                contributeP.style.fontSize = '0.85rem';
                contributeP.style.marginTop = '10px';
                var contributeLink = document.createElement('a');
                contributeLink.href = 'https://github.com/alessfg/nginx-ingress-migration-guide';
                contributeLink.target = '_blank';
                contributeLink.style.color = 'var(--primary-color)';
                contributeLink.textContent = 'Contribute a mapping on GitHub \u2192';
                contributeP.appendChild(contributeLink);
                unrecSection.appendChild(contributeP);
                container.appendChild(unrecSection);
            }
        }

        function clearAnalyzer() {
            document.getElementById('yamlInput').value = '';
            document.getElementById('analyzerResults').textContent = '';
        }

        function loadSampleYaml() {
            document.getElementById('yamlInput').value =
'apiVersion: networking.k8s.io/v1\n' +
'kind: Ingress\n' +
'metadata:\n' +
'  name: example-ingress\n' +
'  annotations:\n' +
'    nginx.ingress.kubernetes.io/rewrite-target: /$2\n' +
'    nginx.ingress.kubernetes.io/use-regex: "true"\n' +
'    nginx.ingress.kubernetes.io/ssl-redirect: "true"\n' +
'    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"\n' +
'    nginx.ingress.kubernetes.io/proxy-body-size: "50m"\n' +
'    nginx.ingress.kubernetes.io/proxy-buffer-size: "8k"\n' +
'    nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"\n' +
'    nginx.ingress.kubernetes.io/proxy-read-timeout: "120"\n' +
'    nginx.ingress.kubernetes.io/proxy-send-timeout: "120"\n' +
'    nginx.ingress.kubernetes.io/limit-rps: "20"\n' +
'    nginx.ingress.kubernetes.io/limit-burst-multiplier: "5"\n' +
'    nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8,172.16.0.0/12"\n' +
'    nginx.ingress.kubernetes.io/enable-cors: "true"\n' +
'    nginx.ingress.kubernetes.io/cors-allow-origin: "https://app.example.com"\n' +
'    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE"\n' +
'    nginx.ingress.kubernetes.io/configuration-snippet: |\n' +
'      more_set_headers "X-Custom-Header: value";\n' +
'    nginx.ingress.kubernetes.io/server-tokens: "false"\n' +
'    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"\n' +
'spec:\n' +
'  ingressClassName: nginx\n' +
'  tls:\n' +
'    - hosts:\n' +
'        - app.example.com\n' +
'      secretName: app-tls\n' +
'  rules:\n' +
'    - host: app.example.com\n' +
'      http:\n' +
'        paths:\n' +
'          - path: /api(/|$)(.*)\n' +
'            pathType: ImplementationSpecific\n' +
'            backend:\n' +
'              service:\n' +
'                name: api-service\n' +
'                port:\n' +
'                  number: 443';
            document.getElementById('analyzerResults').textContent = '';
        }

        function highlightSection(anchorId) {
            var el = document.getElementById(anchorId);
            if (!el) return;
            el.scrollIntoView({ behavior: 'smooth' });
            el.style.transition = 'background-color 0.3s';
            el.style.backgroundColor = '#fff9c4';
            setTimeout(function() {
                el.style.backgroundColor = '';
                setTimeout(function() { el.style.transition = ''; }, 300);
            }, 2000);
        }
    </script>
</body>
</html>
